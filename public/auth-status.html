<!DOCTYPE html>
<html>
<head>
    <style>
        .auth-status {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            font-family: Arial, sans-serif;
            font-size: 14px;
            z-index: 1000;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #0078d4;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .user-details {
            flex-grow: 1;
        }
        
        .user-name {
            font-weight: bold;
            margin-bottom: 2px;
        }
        
        .user-email {
            color: #666;
            font-size: 12px;
        }
        
        .logout-btn {
            background: #f44336;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
        }
        
        .logout-btn:hover {
            background: #d32f2f;
        }
        
        .login-status {
            color: #4caf50;
            font-size: 12px;
            margin-bottom: 5px;
        }
        
        .loading {
            color: #666;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div id="authStatus" class="auth-status">
        <div class="loading">Loading user info...</div>
    </div>

    <script>
        async function loadAuthStatus() {
            try {
                const response = await fetch('/.auth/me');
                const data = await response.json();
                
                const authStatusDiv = document.getElementById('authStatus');
                
                if (data.clientPrincipal && data.clientPrincipal.userDetails) {
                    const user = data.clientPrincipal;
                    const userEmail = user.userDetails;
                    const userName = user.userDetails.split('@')[0]; // Use part before @ as display name
                    const initials = userName.substring(0, 2).toUpperCase();
                    
                    authStatusDiv.innerHTML = `
                        <div class="login-status">âœ“ Logged in to SAXTech ROI Calculator</div>
                        <div class="user-info">
                            <div class="user-avatar">${initials}</div>
                            <div class="user-details">
                                <div class="user-name">${userName}</div>
                                <div class="user-email">${userEmail}</div>
                            </div>
                            <button class="logout-btn" onclick="logout()">Sign Out</button>
                        </div>
                    `;
                } else {
                    // Not authenticated - shouldn't happen due to route protection
                    authStatusDiv.innerHTML = `
                        <div style="color: #f44336;">Not authenticated</div>
                        <a href="/.auth/login/aad" style="color: #0078d4;">Sign In</a>
                    `;
                }
            } catch (error) {
                console.error('Error loading auth status:', error);
                document.getElementById('authStatus').innerHTML = `
                    <div style="color: #f44336;">Auth status unavailable</div>
                `;
            }
        }
        
        function logout() {
            if (confirm('Are you sure you want to sign out?')) {
                window.location.href = '/.auth/logout';
            }
        }
        
        // Load auth status when page loads
        document.addEventListener('DOMContentLoaded', loadAuthStatus);
        
        // Refresh auth status every 5 minutes
        setInterval(loadAuthStatus, 300000);
    </script>
</body>
</html>
